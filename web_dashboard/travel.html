<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mitra AI ‚Äî Travel Planner (AI-Powered)</title>
<script src="api.js"></script>
<style>
body{
  margin:0;
  background:url("https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1600&q=80") no-repeat center center fixed;
  background-size:cover;
  font-family:Poppins, sans-serif;
  color:#fff
}
body::before{content:"";position:fixed;inset:0;background:rgba(0,0,0,0.55);backdrop-filter:blur(2px);z-index:-1}
.header{display:flex;align-items:center;gap:12px;padding:18px;max-width:1100px;margin:20px auto}
.h-title{flex:1;font-size:1.6rem;color:#ffcf66;font-weight:700}
.controls{display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700;transition:transform 0.2s}
.btn:hover{transform:translateY(-2px)}
.btn-voice{background:#ffcf66;color:#041207}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff}
.card{background:rgba(255,200,90,0.08);padding:18px;border-radius:12px;border:1px solid rgba(255,200,90,0.12);backdrop-filter:blur(6px)}
.container{max-width:1100px;margin:10px auto;display:grid;grid-template-columns:1fr 380px;gap:18px;padding:0 18px}

.ai-section{
  background:rgba(255,207,102,0.15);
  padding:20px;
  border-radius:12px;
  border:1px solid rgba(255,207,102,0.3);
  margin-bottom:20px;
}
.ai-response{
  background:rgba(0,0,0,0.5);
  padding:12px;
  border-radius:8px;
  color:#ffcf66;
  font-family:'Courier New',monospace;
  font-size:14px;
  min-height:60px;
  margin-top:10px;
}

.input-row{display:flex;gap:8px;margin-top:12px}
.input-row input{flex:1;padding:10px;border-radius:8px;border:none;background:rgba(0,0,0,0.35);color:#fff;outline:none}
.list{margin-top:12px;display:flex;flex-direction:column;gap:10px}
.item{background:rgba(0,0,0,0.35);padding:10px;border-radius:8px;border-left:4px solid #ffcf66;display:flex;justify-content:space-between;align-items:center}
.del{background:none;border:0;color:#ff6b6b;font-size:1.1rem;cursor:pointer}
.small{font-size:0.95rem;color:#fff3d0}
.back{display:block;text-align:center;color:#ffcf66;text-decoration:none;margin:18px auto}
@media(max-width:1000px){.container{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="header">
  <div class="h-title">‚úàÔ∏è Mitra AI ‚Äî Travel Planner</div>
  <div class="controls">
    <span class="small">Status: <span id="statusText">Idle</span></span>
    <button id="startMic" class="btn btn-voice">üéôÔ∏è Voice</button>
    <button id="stopMic" class="btn btn-ghost">Stop</button>
    <a href="index.html"><button class="btn btn-ghost">‚Üê Home</button></a>
  </div>
</div>

<div class="container">
  <main class="card">
    <h3 style="margin:0 0 15px 0;color:#ffcf66">ü§ñ AI Travel Commands</h3>
    
    <div class="ai-section">
      <div class="input-row">
        <input id="aiInput" placeholder='Say: "Add travel Paris 3 days" or "Plan trip to Tokyo"'>
        <button id="aiSend" class="btn btn-voice">Send</button>
      </div>
      <div class="small" style="margin-top:8px">
        Natural language: "I want to visit London for a week", "Plan Japan trip"
      </div>
      <div id="aiResponse" class="ai-response">
        Try: "Add travel plan: Bali for 5 days"
      </div>
    </div>

    <h3 style="margin:20px 0 10px 0;color:#ffcf66">Your Travel Plans</h3>
    <div class="list" id="travList">
      <div class="small">Loading from cloud...</div>
    </div>
  </main>

  <aside class="card">
    <h3 style="margin:0 0 15px 0;color:#ffcf66">Trip Summary</h3>
    <div style="background:rgba(0,0,0,0.3);padding:15px;border-radius:10px">
      <div style="margin-bottom:10px">
        <div class="small">Total Plans:</div>
        <div style="font-size:1.8rem;font-weight:700;color:#ffcf66" id="tripCount">0</div>
      </div>
      <div>
        <div class="small">Most Recent:</div>
        <div style="font-weight:600;color:#fff3d0;margin-top:5px" id="tripRecent">‚Äî</div>
      </div>
    </div>

    <div style="margin-top:20px">
      <h3 style="margin:0 0 10px 0;color:#ffcf66">Quick Actions</h3>
      <button class="btn btn-voice" onclick="quickCmd('Show all my travel plans')" style="width:100%;margin-bottom:8px">
        View All Plans
      </button>
      <button class="btn btn-ghost" onclick="loadTravel()" style="width:100%">
        üîÑ Refresh
      </button>
    </div>
  </aside>
</div>

<a class="back" href="index.html">‚Üê Back to Dashboard</a>

<script>
const $ = s => document.querySelector(s);
let trips = [];
let recognition = null;
let isListening = false;

// Load travel plans
async function loadTravel() {
  try {
    // For now, we'll use local storage until backend endpoint is added
    // You can add GET /travel endpoint to backend
    const stored = localStorage.getItem('mitraTravel');
    trips = stored ? JSON.parse(stored) : [];
    renderTravel();
    updateSummary();
  } catch (error) {
    console.error('Error loading travel:', error);
  }
}

// Render travel plans
function renderTravel() {
  const el = $('#travList');
  
  if (!trips || trips.length === 0) {
    el.innerHTML = '<div class="small">No travel plans yet. Use AI to add your first trip!</div>';
    return;
  }
  
  el.innerHTML = '';
  
  trips.slice().reverse().forEach((trip, i) => {
    const idx = trips.length - 1 - i;
    const date = new Date(trip.timestamp || trip.when || Date.now());
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <div>
        <strong>‚úàÔ∏è ${trip.text || trip.destination}</strong>
        <div class="small">${trip.duration || ''} ‚Ä¢ ${date.toLocaleDateString()}</div>
      </div>
      <button class="del" onclick="deleteTrip(${idx})">üóë</button>
    `;
    el.appendChild(div);
  });
}

// Update summary
function updateSummary() {
  $('#tripCount').textContent = trips.length;
  $('#tripRecent').textContent = trips.length > 0 ? (trips[trips.length - 1].text || trips[trips.length - 1].destination) : '‚Äî';
}

// Delete trip
function deleteTrip(idx) {
  trips.splice(idx, 1);
  localStorage.setItem('mitraTravel', JSON.stringify(trips));
  renderTravel();
  updateSummary();
}

// Handle AI Commands
async function handleAICommand(text) {
  if (!text.trim()) return;
  
  const responseEl = $('#aiResponse');
  responseEl.textContent = 'ü§î Processing with AI...';
  $('#statusText').textContent = 'Thinking...';
  
  try {
    const reply = await window.askAI(text);
    responseEl.textContent = reply;
    $('#statusText').textContent = 'Ready';
    
    // If travel plan added, add to local storage for now
    if (reply.includes('Travel plan added')) {
      const destination = text.replace(/add|travel|plan|trip|visit|to/gi, '').trim();
      trips.push({
        text: destination,
        destination: destination,
        timestamp: Date.now()
      });
      localStorage.setItem('mitraTravel', JSON.stringify(trips));
      renderTravel();
      updateSummary();
    }
  } catch (error) {
    responseEl.textContent = '‚ùå Error: ' + error.message;
    $('#statusText').textContent = 'Error';
  }
}

function quickCmd(cmd) {
  $('#aiInput').value = cmd;
  handleAICommand(cmd);
}

// Voice Recognition
function initVoice() {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR) {
    alert('Speech recognition not supported. Use Chrome or Edge.');
    return null;
  }
  
  recognition = new SR();
  recognition.lang = 'en-IN';
  recognition.continuous = false;
  recognition.interimResults = false;
  
  recognition.onstart = () => {
    isListening = true;
    $('#statusText').textContent = 'Listening...';
  };
  
  recognition.onend = () => {
    isListening = false;
    $('#statusText').textContent = 'Idle';
  };
  
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    $('#aiInput').value = transcript;
    handleAICommand(transcript);
  };
  
  return recognition;
}

// Event Listeners
$('#aiSend').onclick = () => handleAICommand($('#aiInput').value);
$('#aiInput').onkeypress = (e) => {
  if (e.key === 'Enter') handleAICommand($('#aiInput').value);
};
$('#startMic').onclick = () => {
  if (!recognition) recognition = initVoice();
  if (recognition && !isListening) recognition.start();
};
$('#stopMic').onclick = () => {
  if (recognition && isListening) recognition.stop();
};

// Make functions global
window.quickCmd = quickCmd;
window.deleteTrip = deleteTrip;
window.loadTravel = loadTravel;

// Initialize
loadTravel();
</script>

</body>
</html>