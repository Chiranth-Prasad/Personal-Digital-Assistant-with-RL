<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mitra AI ‚Äî Travel Planner (Voice)</title>
<style>
body{margin:0;background:url("https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1600&q=80") no-repeat center center fixed;background-size:cover;font-family:Poppins, sans-serif;color:#fff}
body::before{content:"";position:fixed;inset:0;background:rgba(0,0,0,0.55);backdrop-filter:blur(2px);z-index:-1}
.header{display:flex;align-items:center;gap:12px;padding:18px;max-width:1100px;margin:20px auto}
.h-title{flex:1;font-size:1.6rem;color:#ffcf66;font-weight:700}
.controls{display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.btn-voice{background:#ffcf66;color:#041207}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff}
.input-row{display:flex;gap:8px;margin-top:12px}
.input-row input{flex:1;padding:10px;border-radius:8px;border:none;background:rgba(0,0,0,0.35);color:#fff}
.card{background:rgba(255,200,90,0.08);padding:18px;border-radius:12px;border:1px solid rgba(255,200,90,0.12);backdrop-filter:blur(6px)}
.container{max-width:1100px;margin:10px auto;display:grid;grid-template-columns:1fr 380px;gap:18px;padding:0 18px}
.list{margin-top:12px;display:flex;flex-direction:column;gap:10px}
.item{background:rgba(0,0,0,0.35);padding:10px;border-radius:8px;border-left:4px solid #ffcf66;display:flex;justify-content:space-between;align-items:center}
.del{background:none;border:0;color:#ff6b6b;font-size:1.1rem;cursor:pointer}
.level{height:9px;border-radius:6px;background:#071217;border:1px solid #183040;overflow:hidden;width:140px}
.level>div{height:100%;width:6%;background:linear-gradient(90deg,#ffd166,#ffef9a)}
.back{display:block;text-align:center;color:#ffcf66;text-decoration:none;margin:18px auto}
.small{font-size:0.95rem;color:#fff3d0}
</style>
</head>
<body>

<div class="header">
  <div class="h-title">Mitra AI ‚Äî Travel Planner</div>
  <div class="controls">
    <button id="startMic" class="btn btn-voice">Start</button>
    <button id="stopMic" class="btn btn-ghost">Stop</button>
    <label class="small">Wake <input id="wake" type="checkbox" checked></label>
    <div class="level"><div id="meter"></div></div>
  </div>
</div>

<div class="container">
  <main class="card">
    <h3 style="margin:0;color:#ffcf66">Add Trip / Plan</h3>
    <p class="small">Say: <b>"add travel Paris 3 days"</b> or <b>"add itinerary visit eiffel tower"</b></p>
    <div class="input-row">
      <input id="travText" placeholder="Example: Paris 3 days ‚Ä¢ Visit museum" />
      <button id="travAdd" class="btn btn-voice">Add</button>
    </div>

    <div class="list" id="travList"></div>
  </main>

  <aside class="card">
    <h3 style="margin:0;color:#ffcf66">Trip Summary</h3>
    <p class="small">A quick overview of saved trips</p>
    <div style="margin-top:12px">
      <div>Total saved trips: <strong id="tripCount">0</strong></div>
      <div style="margin-top:10px">Most recent: <strong id="tripRecent">‚Äî</strong></div>
    </div>
  </aside>
</div>

<a class="back" href="index.html">‚Üê Back to Dashboard</a>

<script>
let trips = JSON.parse(localStorage.getItem("mitraTravel")||"[]");
function save(){ localStorage.setItem("mitraTravel", JSON.stringify(trips)); render(); updateSum(); }
function render(){
  const el = document.getElementById("travList"); el.innerHTML="";
  if(!trips.length){ el.innerHTML='<div class="small">No travel plans yet</div>'; return; }
  trips.slice().reverse().forEach((t,i)=>{ const idx = trips.length-1-i; const d=document.createElement("div"); d.className="item"; d.innerHTML = `<div><strong>${t.text}</strong><div class="small">${t.when}</div></div><div><button class="del" data-i="${idx}">üóë</button></div>`; el.appendChild(d); });
  el.querySelectorAll(".del").forEach(b=>b.onclick=()=>{ trips.splice(+b.dataset.i,1); save(); });
}
function updateSum(){ document.getElementById("tripCount").textContent=trips.length; document.getElementById("tripRecent").textContent = trips.length?trips[trips.length-1].text:"‚Äî"; }
document.getElementById("travAdd").onclick = ()=>{ const v=document.getElementById("travText").value.trim(); if(!v) return; trips.push({text:v, when:new Date().toISOString()}); document.getElementById("travText").value=""; save(); };

const meter = document.getElementById("meter");
let rec=null, micStream=null, analyser=null, raf=null, manualStop=false;
async function warm(){ if(micStream) return; micStream = await navigator.mediaDevices.getUserMedia({audio:true}); const ctx=new (window.AudioContext||window.webkitAudioContext)(); const src = ctx.createMediaStreamSource(micStream); analyser = ctx.createAnalyser(); analyser.fftSize=1024; src.connect(analyser); (function loop(){ if(!analyser) return; const arr = new Uint8Array(analyser.fftSize); analyser.getByteTimeDomainData(arr); let peak=0; for(let v of arr){ const p=Math.abs(v-128); if(p>peak) peak=p; } meter.style.width = Math.min(100, Math.max(6,(peak/64)*100))+'%'; raf = requestAnimationFrame(loop); })(); }
function SR(){ return window.SpeechRecognition || window.webkitSpeechRecognition; }
function start(){
  const Klass = SR(); if(!Klass){ alert("No SpeechRecognition"); return; }
  manualStop=false; rec = new Klass(); rec.lang="en-IN"; rec.interimResults=false; rec.continuous=false;
  rec.onresult = (ev)=>{ for(let i=ev.resultIndex;i<ev.results.length;i++){ if(ev.results[i].isFinal){ handleVoice(ev.results[i][0].transcript.trim()); } } };
  rec.onend = ()=>{ if(!manualStop) setTimeout(()=>{ try{ rec.start(); }catch{} }, 150); };
  try{ rec.start(); }catch(e){ console.warn(e); }
}
function stop(){ manualStop=true; try{ rec && rec.stop(); }catch{} }
document.getElementById("startMic").onclick = async ()=>{ try{ await warm(); }catch(e){ alert("Allow mic"); return; } start(); };
document.getElementById("stopMic").onclick = ()=> stop();

function handleVoice(text){
  const t = text.toLowerCase(); addLog("Heard: "+text);
  const wakeOn = document.getElementById("wake").checked;
  let cmd = t;
  if(wakeOn){
    if(cmd.startsWith("hey mitra")) cmd = cmd.replace(/^hey mitra[, ]*/,"");
    else if(cmd.startsWith("mitra")) cmd = cmd.replace(/^mitra[, ]*/,"");
    else { addLog("Ignored (no wake)"); return; }
  }
  // parse: add travel <text>
  let m = cmd.match(/^(?:add|plan|save)\s+(?:travel|trip|visit)?\s*(.+)$/);
  if(m){ const text = m[1].trim(); trips.push({text, when:new Date().toISOString()}); save(); addLog("Added travel: "+text); return; }
  m = cmd.match(/^add itinerary (.+)$/);
  if(m){ trips.push({text:m[1].trim(), when:new Date().toISOString()}); save(); addLog("Added itinerary"); return; }
  addLog("No match: "+text);
}

function addLog(s){ console.log(s); }
render(); updateSum();
</script>
</body>
</html>
