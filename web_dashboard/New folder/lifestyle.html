<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mitra AI ‚Äî Lifestyle (Voice)</title>
<style>
body{margin:0;background:url("https://images.unsplash.com/photo-1506126613408-eca07ce68773?auto=format&fit=crop&w=1600&q=80") no-repeat center center fixed;background-size:cover;font-family:Poppins, sans-serif;color:#fff}
body::before{content:"";position:fixed;inset:0;background:rgba(0,0,0,0.55);backdrop-filter:blur(2px);z-index:-1}
.header{display:flex;align-items:center;gap:12px;padding:18px;max-width:1100px;margin:20px auto}
.h-title{flex:1;font-size:1.6rem;color:#76ffb4;font-weight:700}
.controls{display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.btn-voice{background:#76ffb4;color:#021207}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff}
.container{max-width:1100px;margin:8px auto;padding:0 18px}
.card{background:rgba(120,255,180,0.08);padding:18px;border-radius:12px;border:1px solid rgba(120,255,180,0.12);backdrop-filter:blur(6px)}
.input-row{display:flex;gap:8px;margin-top:12px}
.input-row input{flex:1;padding:10px;border-radius:8px;border:none;background:rgba(0,0,0,0.35);color:#fff}
.list{margin-top:12px;display:flex;flex-direction:column;gap:10px}
.item{background:rgba(0,0,0,0.35);padding:10px;border-radius:8px;border-left:4px solid #76ffb4;display:flex;justify-content:space-between;align-items:center}
.del{background:none;border:0;color:#ff6b6b;font-size:1.1rem;cursor:pointer}
.level{height:9px;border-radius:6px;background:#071217;border:1px solid #183040;overflow:hidden;width:140px}
.level>div{height:100%;width:6%;background:linear-gradient(90deg,#a7ffda,#76ffb4)}
.back{display:block;text-align:center;color:#76ffb4;text-decoration:none;margin:18px auto}
.small{font-size:0.95rem;color:#e6ffe9}
</style>
</head>
<body>

<div class="header">
  <div class="h-title">Mitra AI ‚Äî Lifestyle Manager</div>
  <div class="controls">
    <button id="startMic" class="btn btn-voice">Start</button>
    <button id="stopMic" class="btn btn-ghost">Stop</button>
    <label class="small">Wake <input id="wake" type="checkbox" checked></label>
    <div class="level"><div id="meter"></div></div>
  </div>
</div>

<div class="container">
  <div class="card">
    <h3 style="margin:0;color:#76ffb4">Add Habit / Goal</h3>
    <p class="small">Say: <b>"add habit meditation 10 min"</b> or <b>"start habit reading"</b></p>
    <div class="input-row">
      <input id="lifeText" placeholder="e.g., Meditation 10 min ‚Ä¢ Read 20 pages" />
      <button id="lifeAdd" class="btn btn-voice">Add</button>
    </div>

    <div class="list" id="lifeList"></div>
  </div>
</div>

<a class="back" href="index.html">‚Üê Back to Dashboard</a>

<script>
let habits = JSON.parse(localStorage.getItem("mitraLifestyle")||"[]");
function save(){ localStorage.setItem("mitraLifestyle", JSON.stringify(habits)); render(); }
function render(){
  const el = document.getElementById("lifeList"); el.innerHTML="";
  if(!habits.length){ el.innerHTML = '<div class="small">No habits yet</div>'; return; }
  habits.slice().reverse().forEach((h,i)=>{ const idx = habits.length-1-i; const node=document.createElement("div"); node.className="item"; node.innerHTML = `<div><strong>${h.text}</strong><div class="small">${h.when}</div></div><div><button class="del" data-i="${idx}">üóë</button></div>`; el.appendChild(node); });
  el.querySelectorAll(".del").forEach(b=>b.onclick=()=>{ habits.splice(+b.dataset.i,1); save(); });
}
document.getElementById("lifeAdd").onclick = ()=>{ const v=document.getElementById("lifeText").value.trim(); if(!v) return; habits.push({text:v, when:new Date().toISOString()}); document.getElementById("lifeText").value=""; save(); };

/* voice */
const meter = document.getElementById("meter"); let rec=null,micStream=null,analyser=null,manualStop=false;
async function warm(){ if(micStream) return; micStream=await navigator.mediaDevices.getUserMedia({audio:true}); const ctx=new (window.AudioContext||window.webkitAudioContext)(); const src=ctx.createMediaStreamSource(micStream); analyser=ctx.createAnalyser(); analyser.fftSize=1024; src.connect(analyser); (function loop(){ if(!analyser) return; const arr=new Uint8Array(analyser.fftSize); analyser.getByteTimeDomainData(arr); let peak=0; for(let v of arr){ const p=Math.abs(v-128); if(p>peak) peak=p; } meter.style.width=Math.min(100,Math.max(6,(peak/64)*100))+'%'; requestAnimationFrame(loop); })(); }
function SR(){ return window.SpeechRecognition||window.webkitSpeechRecognition; }
function start(){ const K=SR(); if(!K){ alert("No SpeechRecognition"); return; } manualStop=false; rec=new K(); rec.lang="en-IN"; rec.interimResults=false; rec.continuous=false; rec.onresult=(ev)=>{ for(let i=ev.resultIndex;i<ev.results.length;i++){ if(ev.results[i].isFinal) handleVoice(ev.results[i][0].transcript.trim()); } }; rec.onend=()=>{ if(!manualStop) setTimeout(()=>{ try{ rec.start(); }catch{} },150); }; try{ rec.start(); }catch(e){ console.warn(e); } }
function stop(){ manualStop=true; try{ rec && rec.stop(); }catch{} }
document.getElementById("startMic").onclick = async ()=>{ try{ await warm(); }catch(e){ alert("Allow mic"); return; } start(); };
document.getElementById("stopMic").onclick = ()=> stop();

function handleVoice(txt){
  const t = txt.toLowerCase(); addLog("Heard: "+txt);
  const wakeOn = document.getElementById("wake").checked;
  let cmd = t;
  if(wakeOn){
    if(cmd.startsWith("hey mitra")) cmd = cmd.replace(/^hey mitra[, ]*/,"");
    else if(cmd.startsWith("mitra")) cmd = cmd.replace(/^mitra[, ]*/,"");
    else { addLog("Ignored (no wake)"); return; }
  }
  // parse: add habit <text>
  let m = cmd.match(/^(?:add|start|create)\s+(?:habit|goal)?\s*(.+)$/);
  if(m){ const text = m[1].trim(); habits.push({text, when:new Date().toISOString()}); save(); addLog("Added habit: "+text); return; }
  addLog("No match: "+txt);
}
function addLog(s){ console.log(s); }

render();
</script>
</body>
</html>
